{"version":3,"file":"kendo.filter.min.js","sources":["kendo.filter.js"],"sourcesContent":["(function(f, define){\n    define('kendo.filter',[ \"kendo.core\", \"kendo.buttongroup\"], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"filter\",\n    name: \"Filter\",\n    category: \"web\",\n    depends: [ \"core\", \"buttongroup\"]\n};\n\nvar editors = {\n    \"number\": \"<input id='#=id#' type='text' aria-label='#=field#' title='#=field#' data-#=ns#role='numerictextbox' data-#=ns#bind='value: value'/>\",\n    \"string\": \"<span class='k-textbox k-input k-input-md k-rounded-md k-input-solid'><input id='#=id#' type='text' aria-label='#=field#' title='#=field#' class='k-input-inner' data-#=ns#bind='value: value'/></span>\",\n    \"boolean\": \"<input id='#=id#' class='k-checkbox k-checkbox-md k-rounded-md' aria-label='#=field#' data-#=ns#role='checkbox' data-#=ns#bind='checked: value' type='checkbox'>\",\n    \"date\": \"<input id='#=id#' type='text' aria-label='#=field#' title='#=field#' data-#=ns#role='datepicker' data-#=ns#bind='value: value'/>\"\n};\n\nvar defaultValues = {\n    \"number\": 0,\n    \"boolean\": false,\n    \"string\": \"\",\n    \"date\": \"\"\n};\n\nvar operatorsTemplate =\n    \"<select data-#=ns#bind='value: operator' title='#=operatorsLabel#' data-#=ns#role='dropdownlist'>\" +\n        \"#for(var op in operators){#\"+\n            \"<option value='#=op#'>#=operators[op].text || operators[op]#</option>\" +\n        \"#}#\" +\n    \"</select>\";\n\nvar logicTemplate =\n    \"<div data-#=ns#bind='value: logic' data-#=ns#role='filterbuttongroup'>\" +\n        \"#for(var op in operators){#\"+\n            \"<span value='#=op#'>#=operators[op]#</span>\" +\n        \"#}#\" +\n    \"</div>\";\n\nvar mainContainer =\n    \"<ul class='k-filter-container'>\" +\n        \"<li class='k-filter-group-main'></li>\" +\n    \"</ul>\";\n\nvar mainLogicTemplate =\n    \"<div class='k-filter-toolbar'>\" +\n        \"<div class='k-toolbar' id='#=uid#'>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                logicTemplate +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' role='button' aria-disabled='false' title='#=addExpression#' aria-label='#=addExpression#' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-filter-add-expression'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' role='button' aria-disabled='false' title='#=addGroup#' aria-label='#=addGroup#' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-filter-add-group'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-flat k-button-flat-base k-icon-button' role='button' title='#=close#' aria-label='#=close#' aria-disabled='false' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-close'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n        \"</div>\" +\n    \"</div>\" ;\n\nvar logicItemTemplate =\n\"<li class='k-filter-item'>\" +\n    \"<div class='k-filter-toolbar'>\" +\n        \"<div class='k-toolbar'>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                logicTemplate +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' role='button' title='#=addExpression#' aria-label='#=addExpression#' aria-disabled='false' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-filter-add-expression'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-icon-button' role='button' title='#=addGroup#' aria-label='#=addGroup#' aria-disabled='false' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-filter-add-group'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n            \"<div class='k-filter-toolbar-item'>\" +\n                \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-flat k-button-flat-base k-icon-button' role='button' title='#=close#' aria-label='#=close#' aria-disabled='false' tabindex='0'>\" +\n                    \"<span class='k-button-icon k-icon k-i-close'>\" +\n                    \"</span>\" +\n                \"</button>\" +\n            \"</div>\" +\n        \"</div>\" +\n    \"</div>\" +\n\"</li>\";\n\nvar expressionItemTemplate =\n\"<li class='k-filter-item'>\" +\n    \"<div class='k-filter-toolbar'>\" +\n       \"<div class='k-toolbar' id='#=uid#'>\" +\n         \"<div class='k-filter-toolbar-item k-filter-field'>\" +\n            \"<select data-#=ns#bind='value: field' title='#=fieldsLabel#' class='k-filter-dropdown' data-auto-width='true' data-#=ns#role='dropdownlist'>\" +\n                \"#for(var current in fields){#\" +\n                    \"<option value='#=fields[current].name#'>#=fields[current].label#</option>\" +\n                \"#}#\" +\n            \"</select>\" +\n         \"</div>\" +\n         \"<div class='k-filter-toolbar-item k-filter-operator'>\" +\n         \"</div>\" +\n         \"<div class='k-filter-toolbar-item k-filter-value'>\" +\n         \"</div>\" +\n         \"<div class='k-filter-toolbar-item'>\" +\n            \"<button data-role='button' class='k-button k-button-md k-rounded-md k-button-flat k-button-flat-base k-icon-button' role='button' title='#=close#' aria-label='#=close#' aria-disabled='false' tabindex='0'>\" +\n                \"<span class='k-button-icon k-icon k-i-close'>\" +\n                \"</span>\" +\n            \"</button>\" +\n         \"</div>\" +\n       \"</div>\" +\n    \"</div>\"+\n\"</li>\";\n\n\n(function($) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        Widget = ui.Widget,\n        ButtonGroup = ui.ButtonGroup,\n        CHANGE = \"change\",\n        NS = \".kendoFilter\",\n        EQ = \"Is equal to\",\n        NEQ = \"Is not equal to\";\n\n    var FilterButtonGroup = ButtonGroup.extend({\n        init: function(element, options) {\n            var that = this;\n            ButtonGroup.fn.init.call(that, element, options);\n        },\n\n        options: {\n            name: \"FilterButtonGroup\"\n        },\n\n        value: function (value) {\n            if (value === undefined) {\n                return this._value;\n            }\n            this._value = value;\n            ButtonGroup.fn.select.call(this, this.wrapper.find(\"[value='\" + value + \"']\")[0]);\n            this.trigger(CHANGE);\n        },\n\n        select: function (button) {\n            if (button !== -1) {\n                this.value($(button).attr(\"value\"));\n            }\n        }\n    });\n\n    var Filter = Widget.extend( {\n        init: function(element, options) {\n            var that = this;\n            var html;\n\n            Widget.fn.init.call(that, element, options);\n\n            that.element = $(element).addClass(\"k-widget k-filter\");\n            that.dataSource = options.dataSource;\n            that.operators = $.extend(that.options.operators, options.operators);\n\n            that._getFieldsInfo();\n            that._modelChangeHandler = that._modelChange.bind(that);\n            that._renderMain();\n            if (options.expression) {\n                that._addExpressionTree(that.filterModel);\n            }\n            that._renderApplyButton();\n            if (that.options.expressionPreview) {\n                if (!that._previewContainer) {\n                    that._previewContainer = $('<div class=\"k-filter-preview\"></div>').insertAfter(that.element.children().eq(0));\n                }\n                html = that._createPreview(that.filterModel.toJSON());\n                that._previewContainer.html(html);\n            }\n            that._attachEvents();\n            that.hasCustomOperators();\n        },\n\n        events: [\n            CHANGE\n        ],\n\n        options: {\n            name: \"Filter\",\n            dataSource: null,\n            expression: null,\n            applyButton: false,\n            fields: [],\n            mainLogic: \"and\",\n            messages: {\n                and: \"And\",\n                or: \"Or\",\n                apply: \"Apply\",\n                close: \"Close\",\n                addExpression: \"Add Expression\",\n                fields: \"Fields\",\n                operators: \"Operators\",\n                addGroup: \"Add Group\"\n            },\n            operators: {\n                string: {\n                    eq: EQ,\n                    neq: NEQ,\n                    startswith: \"Starts with\",\n                    contains: \"Contains\",\n                    doesnotcontain: \"Does not contain\",\n                    endswith: \"Ends with\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\",\n                    isempty: \"Is empty\",\n                    isnotempty: \"Is not empty\",\n                    isnullorempty: \"Has no value\",\n                    isnotnullorempty: \"Has value\"\n                },\n                number: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is greater than or equal to\",\n                    gt: \"Is greater than\",\n                    lte: \"Is less than or equal to\",\n                    lt: \"Is less than\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                date: {\n                    eq: EQ,\n                    neq: NEQ,\n                    gte: \"Is after or equal to\",\n                    gt: \"Is after\",\n                    lte: \"Is before or equal to\",\n                    lt: \"Is before\",\n                    isnull: \"Is null\",\n                    isnotnull: \"Is not null\"\n                },\n                \"boolean\": {\n                    eq: EQ,\n                    neq: NEQ\n                }\n            }\n        },\n\n        applyFilter: function () {\n            var filter = this.filterModel.toJSON();\n\n            if(this._hasCustomOperators){\n                this._mapOperators(filter);\n            }\n            if (this._hasFieldsFilter(filter.filters || [])) {\n                this._removeEmptyGroups(filter.filters);\n                this.dataSource.filter(filter);\n            } else {\n                this.dataSource.filter({});\n            }\n        },\n\n        destroy: function() {\n            this.element.off(NS);\n            kendo.destroy(this.element.find(\".k-filter-group-main\"));\n            this._previewContainer = null;\n            this._applyButton = null;\n            this._modelChangeHandler = null;\n            Widget.fn.destroy.call(this);\n        },\n\n        setOptions: function(options) {\n            kendo.deepExtend(this.options, options);\n            this.destroy();\n            this.element.empty();\n            this.init(this.element, this.options);\n        },\n\n        getOptions: function() {\n            var result = $.extend(true, {}, this.options);\n            delete result.dataSource;\n            result.expression = this.filterModel.toJSON();\n\n            return result;\n        },\n\n        _addExpressionTree: function (model) {\n            if (model.filters) {\n                var parent = this.element.find(\"[id=\" + model.uid + \"]\");\n                for (var i = 0; i < model.filters.length; i++) {\n                    if (model.filters[i].logic) {\n                        this._addGroup(parent, model.filters[i]);\n                    } else {\n                        this._addExpression(parent, model.filters[i]);\n                    }\n                    if (model.filters[i].filters) {\n                        this._addExpressionTree(model.filters[i]);\n                    }\n                }\n            }\n        },\n\n        _attachEvents: function () {\n            var that = this;\n\n            that.element.on(\"click\" + NS, \"button.k-button\" , function (e) {\n                e.preventDefault();\n\n                var button  = $(e.currentTarget);\n                var icon = button.find(\"span\");\n                var command = (icon.length ? icon : button).attr(\"class\").split(\"-\").pop();\n\n                if (command == \"close\") {\n                    that._removeExpression(button.closest(\".k-toolbar\"));\n                } else if (command == \"expression\") {\n                    that._addExpression(button.closest(\".k-toolbar\"));\n                } else if (command == \"group\") {\n                    that._addGroup(button.closest(\".k-toolbar\"));\n                } else if (command == \"apply\") {\n                    that.applyFilter();\n                }\n            });\n        },\n\n        _addExpression: function (parentContainer, model) {\n            var that = this;\n            var parentUID = parentContainer.attr(\"id\");\n            var itemsContainer  = parentContainer.closest(\".k-filter-toolbar\").next(\"ul.k-filter-lines\");\n            var field = model ? that._fields[model.field] : that._defaultField;\n            var expressionModel;\n            var itemHTML = \"\";\n\n            if (model) {\n                expressionModel = model;\n            } else {\n                expressionModel = findModel(that.filterModel, parentUID);\n\n                if (!expressionModel.filters) {\n                    expressionModel.set(\"filters\", []);\n                }\n\n                expressionModel = that._addNewModel(expressionModel.filters, field);\n            }\n\n            if (!itemsContainer.length) {\n                itemsContainer = $(\"<ul class='k-filter-lines'></ul>\").appendTo(parentContainer.closest(\"li\"));\n            }\n\n            itemHTML = $(kendo.template(expressionItemTemplate)({\n                fields: that._fields,\n                operators: that.operators[field.type],\n                close: that.options.messages.close,\n                fieldsLabel: that.options.messages.fields,\n                uid: expressionModel.uid,\n                ns: kendo.ns\n            })).appendTo(itemsContainer);\n\n            that._addExpressionControls(itemHTML.find(\".k-toolbar\"), field, expressionModel);\n\n            if (!model) {\n                that._expressionChange();\n            }\n        },\n\n        _addExpressionControls: function (container, field, filterModel) {\n            var items = container.find(\".k-filter-toolbar-item\");\n            var operatorsContainer = items.eq(1);\n            var editorContainer = items.eq(2);\n\n            kendo.destroy(operatorsContainer);\n            kendo.destroy(editorContainer);\n            operatorsContainer.empty();\n            editorContainer.empty();\n\n            this._appendOperators(operatorsContainer, field);\n            this._appendEditor(editorContainer, field);\n            this._bindModel(container, filterModel);\n            this._showHideEditor(container, filterModel);\n        },\n\n        _appendOperators: function (container, field) {\n            $(kendo.template(operatorsTemplate)({\n                operators: field.operators && field.operators[field.type] ? field.operators[field.type] : this.operators[field.type],\n                operatorsLabel: this.options.messages.operators,\n                ns: kendo.ns\n            })).appendTo(container);\n        },\n\n        _appendEditor: function (container, field) {\n            if (kendo.isFunction(field.editor)) {\n                field.editor(container, $.extend(true, {}, { field: field.name }));\n            } else {\n                $(kendo.template(field.editor)({ns: kendo.ns, field: field.name, id: kendo.guid()})).appendTo(container);\n            }\n        },\n\n        _addNewModel: function (parent, field) {\n            var filterModel;\n            var type = field.type;\n            var operators = field.operators;\n            var operator;\n            if (!operators) {\n                operators = this.options.operators;\n            }\n\n            operator = Object.keys(operators[type])[0];\n\n            parent.push({ field: field.name });\n            filterModel = parent[parent.length - 1];\n\n            filterModel.set(\"value\", field.defaultValue);\n            filterModel.set(\"operator\", operator);\n\n            return filterModel;\n        },\n\n        _addGroup: function (parent, model) {\n            var that = this;\n            var filterModel = that.filterModel;\n            var parentUID = parent.attr(\"id\");\n            var itemsContainer  = parent.closest(\".k-filter-toolbar\").next(\"ul.k-filter-lines\");\n            var logicHTML;\n\n            if (model) {\n                filterModel = model;\n\n            } else {\n                filterModel = findModel(filterModel, parentUID);\n\n                if (!filterModel.filters) {\n                    filterModel.set(\"filters\", []);\n                }\n                filterModel.filters.push({ logic: that.options.mainLogic });\n                filterModel = filterModel.filters[filterModel.filters.length - 1];\n            }\n\n            if (!itemsContainer.length) {\n                itemsContainer = $(\"<ul class='k-filter-lines'></ul>\").appendTo(parent.closest(\"li\"));\n            }\n\n            logicHTML = $(kendo.template(logicItemTemplate)({\n                operators: {\n                    and : that.options.messages.and,\n                    or : that.options.messages.or\n                },\n                addExpression: that.options.messages.addExpression,\n                addGroup: that.options.messages.addGroup,\n                close: that.options.messages.close,\n                ns: kendo.ns\n            })).appendTo(itemsContainer);\n\n            that._bindModel(logicHTML.find(\".k-toolbar\"), filterModel);\n\n            if (!model) {\n                that._expressionChange();\n            }\n        },\n\n        _bindModel: function (container, model) {\n            container.attr(\"id\", model.uid);\n\n            model.bind(\"change\", this._modelChangeHandler);\n            kendo.bind(container, model);\n\n            container.parent().attr(kendo.attr(\"stop\"), true);\n        },\n\n        _createPreview:  function (filter) {\n            var html = \"\";\n            var createdField = false;\n            var haveFields = this._hasFieldsFilter(filter.filters || []);\n            var childhtml = \"\";\n            var current;\n            var field;\n\n            if (!filter.filters || !filter.filters.length || !haveFields) {\n                return \"\";\n            }\n            html += '<span class=\"k-filter-preview-bracket\">(</span>';\n            for (var i = 0 ; i < filter.filters.length; i++) {\n                current = filter.filters[i];\n\n                if (current.filters) {\n                    childhtml = this._createPreview(current);\n                    if (childhtml) {\n                        if (createdField) {\n                            html += '<span class=\"k-filter-preview-operator\"> ' + filter.logic.toLocaleUpperCase() + ' </span>';\n                        }\n                        createdField = true;\n                    }\n                    html += childhtml;\n                }\n                if (current.field) {\n                    field = this._fields[current.field];\n                    if (createdField) {\n                        html += '<span class=\"k-filter-preview-operator\"> ' + filter.logic.toLocaleUpperCase() + ' </span>';\n                    }\n                    createdField = true;\n                    html += '<span class=\"k-filter-preview-field\">' + field.label + '</span>';\n                    html += '<span class=\"k-filter-preview-criteria\"> ' + this._getOperatorText(current.field, current.operator);\n                    if (current.operator.indexOf(\"is\") < 0) {\n                        html += ' </span>';\n                        html += \"<span class='k-filter-preview-value'>'\" + kendo.htmlEncode(field.previewFormat ? kendo.toString(current.value, field.previewFormat) : current.value) + \"'</span>\";\n                    } else {\n                        html += '</span>';\n                    }\n                }\n            }\n            html += '<span class=\"k-filter-preview-bracket\">)</span>';\n            return html;\n        },\n\n        _expressionChange: function() {\n            var that = this;\n            var filter = that.filterModel.toJSON();\n            var html = \"\";\n\n            if (that.options.expressionPreview) {\n                html = that._createPreview(filter);\n                that._previewContainer.html(html);\n            }\n\n            that.trigger(CHANGE, { expression: filter });\n        },\n\n        _getOperatorText: function (field, operator) {\n            var type = this._fields[field].type;\n            var operators = this._fields[field].operators;\n\n            if (!operators) {\n                operators = this.options.operators;\n            }\n\n            return operators[type][operator].text || operators[type][operator];\n        },\n\n        _addField: function(fieldInfo, field) {\n            var that = this;\n            fieldInfo = $.extend(true, {}, {\n                name: fieldInfo.name || field,\n                editor : fieldInfo.editorTemplate || editors[fieldInfo.type || \"string\"],\n                defaultValue : (fieldInfo.defaultValue || fieldInfo.defaultValue === false || fieldInfo.defaultValue === 0) ? fieldInfo.defaultValue : defaultValues[fieldInfo.type || \"string\"],\n                type : fieldInfo.type || \"string\",\n                label : fieldInfo.label || fieldInfo.name || field,\n                operators: fieldInfo.operators,\n                previewFormat: fieldInfo.previewFormat\n            });\n            that._fields[fieldInfo.name] = fieldInfo;\n            if (!that._defaultField) {\n                that._defaultField = fieldInfo;\n            }\n        },\n\n        _getFieldsInfo: function () {\n            var that = this;\n            var fieldsCollection = that.options.fields.length ? that.options.fields : (that.options.dataSource.options.schema.model || {}).fields;\n            var fieldInfo;\n\n            that._fields = {};\n\n            if (Array.isArray(fieldsCollection)) {\n                for (var i = 0; i < fieldsCollection.length; i++) {\n                    fieldInfo = fieldsCollection[i];\n                    that._addField(fieldInfo);\n                }\n            } else {\n                for (var field in fieldsCollection) {\n                    fieldInfo = fieldsCollection[field];\n                    that._addField(fieldInfo, field);\n                }\n            }\n        },\n\n        _hasFieldsFilter: function (filters, haveField) {\n            haveField = !!haveField;\n\n            for (var i = 0 ; i < filters.length; i++) {\n                if (filters[i].filters) {\n                    haveField = this._hasFieldsFilter(filters[i].filters, haveField);\n                }\n                if (filters[i].field) {\n                    return true;\n                }\n            }\n\n            return haveField;\n        },\n\n        _removeEmptyGroups: function (filters) {\n            if (!filters) {\n                return;\n            }\n            for (var i = filters.length - 1; i >= 0; i--) {\n                if ((filters[i].logic && !filters[i].filters) || (filters[i].filters && !this._hasFieldsFilter(filters[i].filters)) ) {\n                    filters.splice(i, 1);\n                    continue;\n                }\n\n                if (filters[i].filters) {\n                    this._removeEmptyGroups(filters[i].filters);\n                }\n            }\n        },\n\n        _modelChange: function (e) {\n            var that = this;\n            var container = that.element.find(\"[id=\" + e.sender.uid + \"]\");\n\n            that._showHideEditor(container, e.sender);\n            if (e.field !== \"field\") {\n                if (e.field !== \"filters\") {\n                  that._expressionChange();\n                }\n                return;\n            }\n\n            var newField = e.sender.field;\n            var parent = e.sender.parent();\n            var field = that._fields[newField];\n            var filterModel = that._addNewModel(parent, field);\n\n            e.sender.unbind(\"change\", that._modelChangeHandler);\n\n            parent.remove(e.sender);\n\n            that._addExpressionControls(container, field, filterModel);\n\n            that._expressionChange();\n        },\n\n        _renderMain: function() {\n            var that = this;\n\n            $(mainContainer).appendTo(that.element);\n\n            if (that.options.expression) {\n                that.filterModel = kendo.observable(that.options.expression);\n            } else {\n                that.filterModel = kendo.observable({\n                    logic: that.options.mainLogic\n                });\n            }\n\n            $(kendo.template(mainLogicTemplate)({\n                operators: {\n                    and : that.options.messages.and,\n                    or : that.options.messages.or\n                },\n                addExpression: that.options.messages.addExpression,\n                addGroup: that.options.messages.addGroup,\n                close: that.options.messages.close,\n                uid: that.filterModel.uid,\n                ns: kendo.ns\n            })).appendTo(that.element.find(\"li\").first());\n\n            that._bindModel(that.element.find(\".k-toolbar\").first(), that.filterModel);\n        },\n\n        _removeExpression: function (parent) {\n            var that = this;\n            var parentUID = parent.attr(\"id\");\n            var itemContainer = parent.closest(\"li\");\n            var isMain = itemContainer.hasClass(\"k-filter-group-main\");\n            var parentModel;\n            var model;\n\n            if (isMain) {\n                itemContainer = itemContainer.find(\".k-filter-lines\");\n                if (that.filterModel.filters) {\n                    that.filterModel.filters.empty();\n                    delete that.filterModel.filters;\n                }\n            } else {\n                model = findModel(that.filterModel, parentUID);\n                parentModel = model.parent();\n                model.unbind(\"change\", that._modelChangeHandler);\n                parentModel.remove(model);\n                if (!parentModel.length) {\n                    delete parentModel.parent().filters;\n                }\n                if (!itemContainer.siblings().length) {\n                    itemContainer = itemContainer.parent();\n                }\n            }\n\n            kendo.destroy(itemContainer);\n            itemContainer.remove();\n            that._expressionChange();\n        },\n\n        _renderApplyButton: function() {\n            var that = this;\n\n            if (!that.options.applyButton) {\n                return;\n            }\n\n            if (!that._applyButton) {\n                that._applyButton = $(kendo.format('<button type=\"button\" aria-label=\"{0}\" title=\"{0}\" class=\"k-button k-button-md k-rounded-md k-button-solid k-button-solid-base k-filter-apply\">{0}</button>', that.options.messages.apply)).appendTo(that.element);\n            }\n        },\n\n        _showHideEditor: function (container, model) {\n            if (model.logic) {\n                return;\n            }\n\n            var operator = model.operator;\n            var editorContainer = container.find(\".k-filter-toolbar-item\").eq(2);\n            if (operator == \"isnull\" || operator == \"isnotnull\" || operator == \"isempty\" ||\n                operator == \"isnotempty\" || operator == \"isnullorempty\" || operator == \"isnotnullorempty\") {\n                editorContainer.hide();\n            } else {\n                editorContainer.show();\n            }\n        },\n\n        _mapOperators: function (expression) {\n            var that = this;\n            if (expression.filters) {\n                expression.filters.forEach(function (filter) {\n                    if (filter.filters) {\n                        that._mapOperators(filter);\n                    } else {\n                        var operator;\n                        var field = that._fields[filter.field];\n                        var type = field.type;\n                        if (field.operators && field.operators[type][filter.operator]) {\n                            operator = field.operators[type][filter.operator];\n                        } else {\n                            operator = that.operators[type][filter.operator];\n                        }\n\n                        if (operator) {\n                            filter.operator = operator.handler || filter.operator;\n                        }\n                    }\n                });\n            }\n        },\n\n        hasCustomOperators: function () {\n            var operators = $.extend(true, {}, this.operators);\n\n            for (var field in this._fields) {\n                operators = $.extend(true, {}, operators, this._fields[field].operators);\n            }\n            this._hasCustomOperators = findCustomOperators(operators);\n        }\n\n    });\n\n    function findCustomOperators(operators) {\n        for (var field in operators) {\n            var operator = operators[field];\n            if ((operator.handler && typeof operator.handler === \"function\") ||\n                (typeof operator === 'object' && operator !== null && findCustomOperators(operator))) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    function findModel(model, uid) {\n\n        if (model.uid === uid) {\n            return model;\n        }\n\n        if (model.filters) {\n            for(var i = 0; i < model.filters.length; i++) {\n                var temp = findModel(model.filters[i], uid);\n                if (temp) {\n                    return temp;\n                }\n            }\n        }\n    }\n\n    ui.plugin(Filter);\n    ui.plugin(FilterButtonGroup);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","editors","number","string","boolean","date","defaultValues","operatorsTemplate","logicTemplate","mainContainer","mainLogicTemplate","logicItemTemplate","expressionItemTemplate","$","window","kendo","jQuery","ui","Widget","ButtonGroup","CHANGE","NS","EQ","NEQ","FilterButtonGroup","extend","init","element","options","that","this","fn","call","value","undefined","_value","select","wrapper","find","trigger","button","attr","Filter","html","addClass","dataSource","operators","_getFieldsInfo","_modelChangeHandler","_modelChange","bind","_renderMain","expression","_addExpressionTree","filterModel","_renderApplyButton","expressionPreview","_previewContainer","insertAfter","children","eq","_createPreview","toJSON","_attachEvents","hasCustomOperators","events","applyButton","fields","mainLogic","messages","and","or","apply","close","addExpression","addGroup","neq","startswith","contains","doesnotcontain","endswith","isnull","isnotnull","isempty","isnotempty","isnullorempty","isnotnullorempty","gte","gt","lte","lt","applyFilter","filter","_hasCustomOperators","_mapOperators","_hasFieldsFilter","filters","_removeEmptyGroups","destroy","off","_applyButton","setOptions","deepExtend","empty","getOptions","result","model","parent","uid","i","length","logic","_addGroup","_addExpression","on","e","preventDefault","currentTarget","icon","command","split","pop","_removeExpression","closest","parentContainer","parentUID","itemsContainer","next","field","_fields","_defaultField","expressionModel","itemHTML","findModel","set","_addNewModel","appendTo","template","type","fieldsLabel","ns","_addExpressionControls","_expressionChange","container","items","operatorsContainer","editorContainer","_appendOperators","_appendEditor","_bindModel","_showHideEditor","operatorsLabel","isFunction","editor","guid","operator","Object","keys","push","defaultValue","logicHTML","createdField","haveFields","childhtml","current","toLocaleUpperCase","label","_getOperatorText","indexOf","htmlEncode","previewFormat","toString","text","_addField","fieldInfo","editorTemplate","fieldsCollection","schema","Array","isArray","haveField","splice","sender","newField","unbind","remove","observable","first","itemContainer","isMain","hasClass","parentModel","siblings","format","hide","show","forEach","handler","findCustomOperators","temp","plugin","amd","a1","a2","a3"],"mappings":"CAAA,SAAaA,QACTA,OAAO,eAAe,CAAE,aAAc,qBACvC,WAEH,IAAIC,EAAW,CACXC,GAAI,SACJC,KAAM,SACNC,SAAU,MACVC,QAAS,CAAE,OAAQ,gBAGnBC,EAAU,CACVC,OAAU,uIACVC,OAAU,0MACVC,QAAW,mKACXC,KAAQ,oIAGRC,EAAgB,CAChBJ,OAAU,EACVE,QAAW,MACXD,OAAU,GACVE,KAAQ,IAGRE,EACA,oGACI,8BACI,wEACJ,MACJ,YAEAC,EACA,yEACI,8BACI,8CACJ,MACJ,SAEAC,EACA,kCACI,wCACJ,QAEAC,EACA,iCACI,sCACI,sCACIF,EACJ,SACA,sCACI,iOACI,gEACA,UACJ,YACJ,SACA,sCACI,uNACI,2DACA,UACJ,YACJ,SACA,sCACI,+MACI,gDACA,UACJ,YACJ,SACJ,SACJ,SAEAG,EACJ,6BACI,iCACI,0BACI,sCACIH,EACJ,SACA,sCACI,iOACI,gEACA,UACJ,YACJ,SACA,sCACI,uNACI,2DACA,UACJ,YACJ,SACA,sCACI,+MACI,gDACA,UACJ,YACJ,SACJ,SACJ,SACJ,QAEII,EACJ,6BACI,iCACG,sCACE,qDACG,+IACI,gCACI,4EACJ,MACJ,YACH,SACA,wDACA,SACA,qDACA,SACA,sCACG,+MACI,gDACA,UACJ,YACH,SACF,SACH,SACJ,QAGUC,EAqpBPC,OAAOC,MAAMC,OAppBRD,EAAQD,OAAOC,MACfE,EAAKF,EAAME,GACXC,EAASD,EAAGC,OACZC,EAAcF,EAAGE,YACjBC,EAAS,SACTC,EAAK,eACLC,EAAK,cACLC,EAAM,kBAENC,EAAoBL,EAAYM,OAAO,CACvCC,KAAM,SAASC,EAASC,GACpB,IAAIC,EAAOC,KACXX,EAAYY,GAAGL,KAAKM,KAAKH,EAAMF,EAASC,IAG5CA,QAAS,CACL9B,KAAM,qBAGVmC,MAAO,SAAUA,GACb,GAAIA,IAAUC,UACV,OAAOJ,KAAKK,OAEhBL,KAAKK,OAASF,EACdd,EAAYY,GAAGK,OAAOJ,KAAKF,KAAMA,KAAKO,QAAQC,KAAK,WAAaL,EAAQ,MAAM,IAC9EH,KAAKS,QAAQnB,IAGjBgB,OAAQ,SAAUI,GACd,GAAIA,KAAY,EACZV,KAAKG,MAAMpB,EAAE2B,GAAQC,KAAK,aAKlCC,EAASxB,EAAOO,OAAQ,CACxBC,KAAM,SAASC,EAASC,GACpB,IAAIC,EAAOC,KACX,IAAIa,EAEJzB,EAAOa,GAAGL,KAAKM,KAAKH,EAAMF,EAASC,GAEnCC,EAAKF,QAAUd,EAAEc,GAASiB,SAAS,qBACnCf,EAAKgB,WAAajB,EAAQiB,WAC1BhB,EAAKiB,UAAYjC,EAAEY,OAAOI,EAAKD,QAAQkB,UAAWlB,EAAQkB,WAE1DjB,EAAKkB,iBACLlB,EAAKmB,oBAAsBnB,EAAKoB,aAAaC,KAAKrB,GAClDA,EAAKsB,cACL,GAAIvB,EAAQwB,WACRvB,EAAKwB,mBAAmBxB,EAAKyB,aAEjCzB,EAAK0B,qBACL,GAAI1B,EAAKD,QAAQ4B,kBAAmB,CAChC,IAAK3B,EAAK4B,kBACN5B,EAAK4B,kBAAoB5C,EAAE,wCAAwC6C,YAAY7B,EAAKF,QAAQgC,WAAWC,GAAG,IAE9GjB,EAAOd,EAAKgC,eAAehC,EAAKyB,YAAYQ,UAC5CjC,EAAK4B,kBAAkBd,KAAKA,GAEhCd,EAAKkC,gBACLlC,EAAKmC,sBAGTC,OAAQ,CACJ7C,GAGJQ,QAAS,CACL9B,KAAM,SACN+C,WAAY,KACZO,WAAY,KACZc,YAAa,MACbC,OAAQ,GACRC,UAAW,MACXC,SAAU,CACNC,IAAK,MACLC,GAAI,KACJC,MAAO,QACPC,MAAO,QACPC,cAAe,iBACfP,OAAQ,SACRrB,UAAW,YACX6B,SAAU,aAEd7B,UAAW,CACP3C,OAAQ,CACJyD,GAAItC,EACJsD,IAAKrD,EACLsD,WAAY,cACZC,SAAU,WACVC,eAAgB,mBAChBC,SAAU,YACVC,OAAQ,UACRC,UAAW,cACXC,QAAS,WACTC,WAAY,eACZC,cAAe,eACfC,iBAAkB,aAEtBpF,OAAQ,CACJ0D,GAAItC,EACJsD,IAAKrD,EACLgE,IAAK,8BACLC,GAAI,kBACJC,IAAK,2BACLC,GAAI,eACJT,OAAQ,UACRC,UAAW,eAEf7E,KAAM,CACFuD,GAAItC,EACJsD,IAAKrD,EACLgE,IAAK,uBACLC,GAAI,WACJC,IAAK,wBACLC,GAAI,YACJT,OAAQ,UACRC,UAAW,eAEf9E,QAAW,CACPwD,GAAItC,EACJsD,IAAKrD,KAKjBoE,YAAa,WACT,IAAIC,EAAS9D,KAAKwB,YAAYQ,SAE9B,GAAGhC,KAAK+D,oBACJ/D,KAAKgE,cAAcF,GAEvB,GAAI9D,KAAKiE,iBAAiBH,EAAOI,SAAW,IAAK,CAC7ClE,KAAKmE,mBAAmBL,EAAOI,SAC/BlE,KAAKe,WAAW+C,OAAOA,QAEvB9D,KAAKe,WAAW+C,OAAO,KAI/BM,QAAS,WACLpE,KAAKH,QAAQwE,IAAI9E,GACjBN,EAAMmF,QAAQpE,KAAKH,QAAQW,KAAK,yBAChCR,KAAK2B,kBAAoB,KACzB3B,KAAKsE,aAAe,KACpBtE,KAAKkB,oBAAsB,KAC3B9B,EAAOa,GAAGmE,QAAQlE,KAAKF,OAG3BuE,WAAY,SAASzE,GACjBb,EAAMuF,WAAWxE,KAAKF,QAASA,GAC/BE,KAAKoE,UACLpE,KAAKH,QAAQ4E,QACbzE,KAAKJ,KAAKI,KAAKH,QAASG,KAAKF,UAGjC4E,WAAY,WACR,IAAIC,EAAS5F,EAAEY,OAAO,KAAM,GAAIK,KAAKF,gBAC9B6E,EAAO5D,WACd4D,EAAOrD,WAAatB,KAAKwB,YAAYQ,SAErC,OAAO2C,GAGXpD,mBAAoB,SAAUqD,GAC1B,GAAIA,EAAMV,QAAS,CACf,IAAIW,EAAS7E,KAAKH,QAAQW,KAAK,OAASoE,EAAME,IAAM,KACpD,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAMV,QAAQc,OAAQD,IAAK,CAC3C,GAAIH,EAAMV,QAAQa,GAAGE,MACjBjF,KAAKkF,UAAUL,EAAQD,EAAMV,QAAQa,SAErC/E,KAAKmF,eAAeN,EAAQD,EAAMV,QAAQa,IAE9C,GAAIH,EAAMV,QAAQa,GAAGb,QACjBlE,KAAKuB,mBAAmBqD,EAAMV,QAAQa,OAMtD9C,cAAe,WACX,IAAIlC,EAAOC,KAEXD,EAAKF,QAAQuF,GAAG,QAAU7F,EAAI,kBAAoB,SAAU8F,GACxDA,EAAEC,iBAEF,IAAI5E,EAAU3B,EAAEsG,EAAEE,eAClB,IAAIC,EAAO9E,EAAOF,KAAK,QACvB,IAAIiF,GAAWD,EAAKR,OAASQ,EAAO9E,GAAQC,KAAK,SAAS+E,MAAM,KAAKC,MAErE,GAAIF,GAAW,QACX1F,EAAK6F,kBAAkBlF,EAAOmF,QAAQ,oBACnC,GAAIJ,GAAW,aAClB1F,EAAKoF,eAAezE,EAAOmF,QAAQ,oBAChC,GAAIJ,GAAW,QAClB1F,EAAKmF,UAAUxE,EAAOmF,QAAQ,oBAC3B,GAAIJ,GAAW,QAClB1F,EAAK8D,iBAKjBsB,eAAgB,SAAUW,EAAiBlB,GACvC,IAAI7E,EAAOC,KACX,IAAI+F,EAAYD,EAAgBnF,KAAK,MACrC,IAAIqF,EAAkBF,EAAgBD,QAAQ,qBAAqBI,KAAK,qBACxE,IAAIC,EAAQtB,EAAQ7E,EAAKoG,QAAQvB,EAAMsB,OAASnG,EAAKqG,cACrD,IAAIC,EACJ,IAAIC,EAAW,GAEf,GAAI1B,EACAyB,EAAkBzB,MACf,CACHyB,EAAkBE,EAAUxG,EAAKyB,YAAauE,GAE9C,IAAKM,EAAgBnC,QACjBmC,EAAgBG,IAAI,UAAW,IAGnCH,EAAkBtG,EAAK0G,aAAaJ,EAAgBnC,QAASgC,GAGjE,IAAKF,EAAehB,OAChBgB,EAAiBjH,EAAE,oCAAoC2H,SAASZ,EAAgBD,QAAQ,OAG5FS,EAAWvH,EAAEE,EAAM0H,SAAS7H,EAAfG,CAAuC,CAChDoD,OAAQtC,EAAKoG,QACbnF,UAAWjB,EAAKiB,UAAUkF,EAAMU,MAChCjE,MAAO5C,EAAKD,QAAQyC,SAASI,MAC7BkE,YAAa9G,EAAKD,QAAQyC,SAASF,OACnCyC,IAAKuB,EAAgBvB,IACrBgC,GAAI7H,EAAM6H,MACVJ,SAASV,GAEbjG,EAAKgH,uBAAuBT,EAAS9F,KAAK,cAAe0F,EAAOG,GAEhE,IAAKzB,EACD7E,EAAKiH,qBAIbD,uBAAwB,SAAUE,EAAWf,EAAO1E,GAChD,IAAI0F,EAAQD,EAAUzG,KAAK,0BAC3B,IAAI2G,EAAqBD,EAAMpF,GAAG,GAClC,IAAIsF,EAAkBF,EAAMpF,GAAG,GAE/B7C,EAAMmF,QAAQ+C,GACdlI,EAAMmF,QAAQgD,GACdD,EAAmB1C,QACnB2C,EAAgB3C,QAEhBzE,KAAKqH,iBAAiBF,EAAoBjB,GAC1ClG,KAAKsH,cAAcF,EAAiBlB,GACpClG,KAAKuH,WAAWN,EAAWzF,GAC3BxB,KAAKwH,gBAAgBP,EAAWzF,IAGpC6F,iBAAkB,SAAUJ,EAAWf,GACnCnH,EAAEE,EAAM0H,SAASlI,EAAfQ,CAAkC,CAChC+B,UAAWkF,EAAMlF,WAAakF,EAAMlF,UAAUkF,EAAMU,MAAQV,EAAMlF,UAAUkF,EAAMU,MAAQ5G,KAAKgB,UAAUkF,EAAMU,MAC/Ga,eAAgBzH,KAAKF,QAAQyC,SAASvB,UACtC8F,GAAI7H,EAAM6H,MACVJ,SAASO,IAGjBK,cAAe,SAAUL,EAAWf,GAChC,GAAIjH,EAAMyI,WAAWxB,EAAMyB,QACvBzB,EAAMyB,OAAOV,EAAWlI,EAAEY,OAAO,KAAM,GAAI,CAAEuG,MAAOA,EAAMlI,aAE1De,EAAEE,EAAM0H,SAAST,EAAMyB,OAArB1I,CAA6B,CAAC6H,GAAI7H,EAAM6H,GAAIZ,MAAOA,EAAMlI,KAAMD,GAAIkB,EAAM2I,UAAUlB,SAASO,IAItGR,aAAc,SAAU5B,EAAQqB,GAC5B,IAAI1E,EACJ,IAAIoF,EAAOV,EAAMU,KACjB,IAAI5F,EAAYkF,EAAMlF,UACtB,IAAI6G,EACJ,IAAK7G,EACDA,EAAYhB,KAAKF,QAAQkB,UAG7B6G,EAAWC,OAAOC,KAAK/G,EAAU4F,IAAO,GAExC/B,EAAOmD,KAAK,CAAE9B,MAAOA,EAAMlI,OAC3BwD,EAAcqD,EAAOA,EAAOG,OAAS,GAErCxD,EAAYgF,IAAI,QAASN,EAAM+B,cAC/BzG,EAAYgF,IAAI,WAAYqB,GAE5B,OAAOrG,GAGX0D,UAAW,SAAUL,EAAQD,GACzB,IAAI7E,EAAOC,KACX,IAAIwB,EAAczB,EAAKyB,YACvB,IAAIuE,EAAYlB,EAAOlE,KAAK,MAC5B,IAAIqF,EAAkBnB,EAAOgB,QAAQ,qBAAqBI,KAAK,qBAC/D,IAAIiC,EAEJ,GAAItD,EACApD,EAAcoD,MAEX,CACHpD,EAAc+E,EAAU/E,EAAauE,GAErC,IAAKvE,EAAY0C,QACb1C,EAAYgF,IAAI,UAAW,IAE/BhF,EAAY0C,QAAQ8D,KAAK,CAAE/C,MAAOlF,EAAKD,QAAQwC,YAC/Cd,EAAcA,EAAY0C,QAAQ1C,EAAY0C,QAAQc,OAAS,GAGnE,IAAKgB,EAAehB,OAChBgB,EAAiBjH,EAAE,oCAAoC2H,SAAS7B,EAAOgB,QAAQ,OAGnFqC,EAAYnJ,EAAEE,EAAM0H,SAAS9H,EAAfI,CAAkC,CAC5C+B,UAAW,CACPwB,IAAMzC,EAAKD,QAAQyC,SAASC,IAC5BC,GAAK1C,EAAKD,QAAQyC,SAASE,IAE/BG,cAAe7C,EAAKD,QAAQyC,SAASK,cACrCC,SAAU9C,EAAKD,QAAQyC,SAASM,SAChCF,MAAO5C,EAAKD,QAAQyC,SAASI,MAC7BmE,GAAI7H,EAAM6H,MACVJ,SAASV,GAEbjG,EAAKwH,WAAWW,EAAU1H,KAAK,cAAegB,GAE9C,IAAKoD,EACD7E,EAAKiH,qBAIbO,WAAY,SAAUN,EAAWrC,GAC7BqC,EAAUtG,KAAK,KAAMiE,EAAME,KAE3BF,EAAMxD,KAAK,SAAUpB,KAAKkB,qBAC1BjC,EAAMmC,KAAK6F,EAAWrC,GAEtBqC,EAAUpC,SAASlE,KAAK1B,EAAM0B,KAAK,QAAS,OAGhDoB,eAAiB,SAAU+B,GACvB,IAAIjD,EAAO,GACX,IAAIsH,EAAe,MACnB,IAAIC,EAAapI,KAAKiE,iBAAiBH,EAAOI,SAAW,IACzD,IAAImE,EAAY,GAChB,IAAIC,EACJ,IAAIpC,EAEJ,IAAKpC,EAAOI,UAAYJ,EAAOI,QAAQc,SAAWoD,EAC9C,MAAO,GAEXvH,GAAQ,kDACR,IAAK,IAAIkE,EAAI,EAAIA,EAAIjB,EAAOI,QAAQc,OAAQD,IAAK,CAC7CuD,EAAUxE,EAAOI,QAAQa,GAEzB,GAAIuD,EAAQpE,QAAS,CACjBmE,EAAYrI,KAAK+B,eAAeuG,GAChC,GAAID,EAAW,CACX,GAAIF,EACAtH,GAAQ,4CAA8CiD,EAAOmB,MAAMsD,oBAAsB,WAE7FJ,EAAe,KAEnBtH,GAAQwH,EAEZ,GAAIC,EAAQpC,MAAO,CACfA,EAAQlG,KAAKmG,QAAQmC,EAAQpC,OAC7B,GAAIiC,EACAtH,GAAQ,4CAA8CiD,EAAOmB,MAAMsD,oBAAsB,WAE7FJ,EAAe,KACftH,GAAQ,wCAA0CqF,EAAMsC,MAAQ,UAChE3H,GAAQ,4CAA8Cb,KAAKyI,iBAAiBH,EAAQpC,MAAOoC,EAAQT,UACnG,GAAIS,EAAQT,SAASa,QAAQ,MAAQ,EAAG,CACpC7H,GAAQ,WACRA,GAAQ,yCAA2C5B,EAAM0J,WAAWzC,EAAM0C,cAAgB3J,EAAM4J,SAASP,EAAQnI,MAAO+F,EAAM0C,eAAiBN,EAAQnI,OAAS,gBAEhKU,GAAQ,WAIpBA,GAAQ,kDACR,OAAOA,GAGXmG,kBAAmB,WACf,IAAIjH,EAAOC,KACX,IAAI8D,EAAS/D,EAAKyB,YAAYQ,SAC9B,IAAInB,EAAO,GAEX,GAAId,EAAKD,QAAQ4B,kBAAmB,CAChCb,EAAOd,EAAKgC,eAAe+B,GAC3B/D,EAAK4B,kBAAkBd,KAAKA,GAGhCd,EAAKU,QAAQnB,EAAQ,CAAEgC,WAAYwC,KAGvC2E,iBAAkB,SAAUvC,EAAO2B,GAC/B,IAAIjB,EAAO5G,KAAKmG,QAAQD,GAAOU,KAC/B,IAAI5F,EAAYhB,KAAKmG,QAAQD,GAAOlF,UAEpC,IAAKA,EACDA,EAAYhB,KAAKF,QAAQkB,UAG7B,OAAOA,EAAU4F,GAAMiB,GAAUiB,MAAQ9H,EAAU4F,GAAMiB,IAG7DkB,UAAW,SAASC,EAAW9C,GAC3B,IAAInG,EAAOC,KACXgJ,EAAYjK,EAAEY,OAAO,KAAM,GAAI,CAC3B3B,KAAMgL,EAAUhL,MAAQkI,EACxByB,OAASqB,EAAUC,gBAAkB9K,EAAQ6K,EAAUpC,MAAQ,UAC/DqB,aAAgBe,EAAUf,cAAgBe,EAAUf,eAAiB,OAASe,EAAUf,eAAiB,EAAKe,EAAUf,aAAezJ,EAAcwK,EAAUpC,MAAQ,UACvKA,KAAOoC,EAAUpC,MAAQ,SACzB4B,MAAQQ,EAAUR,OAASQ,EAAUhL,MAAQkI,EAC7ClF,UAAWgI,EAAUhI,UACrB4H,cAAeI,EAAUJ,gBAE7B7I,EAAKoG,QAAQ6C,EAAUhL,MAAQgL,EAC/B,IAAKjJ,EAAKqG,cACNrG,EAAKqG,cAAgB4C,GAI7B/H,eAAgB,WACZ,IAAIlB,EAAOC,KACX,IAAIkJ,EAAmBnJ,EAAKD,QAAQuC,OAAO2C,OAASjF,EAAKD,QAAQuC,QAAUtC,EAAKD,QAAQiB,WAAWjB,QAAQqJ,OAAOvE,OAAS,IAAIvC,OAC/H,IAAI2G,EAEJjJ,EAAKoG,QAAU,GAEf,GAAIiD,MAAMC,QAAQH,GACd,IAAK,IAAInE,EAAI,EAAGA,EAAImE,EAAiBlE,OAAQD,IAAK,CAC9CiE,EAAYE,EAAiBnE,GAC7BhF,EAAKgJ,UAAUC,QAGnB,IAAK,IAAI9C,KAASgD,EAAkB,CAChCF,EAAYE,EAAiBhD,GAC7BnG,EAAKgJ,UAAUC,EAAW9C,KAKtCjC,iBAAkB,SAAUC,EAASoF,GACjCA,IAAcA,EAEd,IAAK,IAAIvE,EAAI,EAAIA,EAAIb,EAAQc,OAAQD,IAAK,CACtC,GAAIb,EAAQa,GAAGb,QACXoF,EAAYtJ,KAAKiE,iBAAiBC,EAAQa,GAAGb,QAASoF,GAE1D,GAAIpF,EAAQa,GAAGmB,MACX,OAAO,KAIf,OAAOoD,GAGXnF,mBAAoB,SAAUD,GAC1B,IAAKA,EACD,OAEJ,IAAK,IAAIa,EAAIb,EAAQc,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC1C,GAAKb,EAAQa,GAAGE,QAAUf,EAAQa,GAAGb,SAAaA,EAAQa,GAAGb,UAAYlE,KAAKiE,iBAAiBC,EAAQa,GAAGb,SAAY,CAClHA,EAAQqF,OAAOxE,EAAG,GAClB,SAGJ,GAAIb,EAAQa,GAAGb,QACXlE,KAAKmE,mBAAmBD,EAAQa,GAAGb,WAK/C/C,aAAc,SAAUkE,GACpB,IAAItF,EAAOC,KACX,IAAIiH,EAAYlH,EAAKF,QAAQW,KAAK,OAAS6E,EAAEmE,OAAO1E,IAAM,KAE1D/E,EAAKyH,gBAAgBP,EAAW5B,EAAEmE,QAClC,GAAInE,EAAEa,QAAU,QAAS,CACrB,GAAIb,EAAEa,QAAU,UACdnG,EAAKiH,oBAEP,OAGJ,IAAIyC,EAAWpE,EAAEmE,OAAOtD,MACxB,IAAIrB,EAASQ,EAAEmE,OAAO3E,SACtB,IAAIqB,EAAQnG,EAAKoG,QAAQsD,GACzB,IAAIjI,EAAczB,EAAK0G,aAAa5B,EAAQqB,GAE5Cb,EAAEmE,OAAOE,OAAO,SAAU3J,EAAKmB,qBAE/B2D,EAAO8E,OAAOtE,EAAEmE,QAEhBzJ,EAAKgH,uBAAuBE,EAAWf,EAAO1E,GAE9CzB,EAAKiH,qBAGT3F,YAAa,WACT,IAAItB,EAAOC,KAEXjB,EAAEJ,GAAe+H,SAAS3G,EAAKF,SAE/B,GAAIE,EAAKD,QAAQwB,WACbvB,EAAKyB,YAAcvC,EAAM2K,WAAW7J,EAAKD,QAAQwB,iBAEjDvB,EAAKyB,YAAcvC,EAAM2K,WAAW,CAChC3E,MAAOlF,EAAKD,QAAQwC,YAI5BvD,EAAEE,EAAM0H,SAAS/H,EAAfK,CAAkC,CAChC+B,UAAW,CACPwB,IAAMzC,EAAKD,QAAQyC,SAASC,IAC5BC,GAAK1C,EAAKD,QAAQyC,SAASE,IAE/BG,cAAe7C,EAAKD,QAAQyC,SAASK,cACrCC,SAAU9C,EAAKD,QAAQyC,SAASM,SAChCF,MAAO5C,EAAKD,QAAQyC,SAASI,MAC7BmC,IAAK/E,EAAKyB,YAAYsD,IACtBgC,GAAI7H,EAAM6H,MACVJ,SAAS3G,EAAKF,QAAQW,KAAK,MAAMqJ,SAErC9J,EAAKwH,WAAWxH,EAAKF,QAAQW,KAAK,cAAcqJ,QAAS9J,EAAKyB,cAGlEoE,kBAAmB,SAAUf,GACzB,IAAI9E,EAAOC,KACX,IAAI+F,EAAYlB,EAAOlE,KAAK,MAC5B,IAAImJ,EAAgBjF,EAAOgB,QAAQ,MACnC,IAAIkE,EAASD,EAAcE,SAAS,uBACpC,IAAIC,EACJ,IAAIrF,EAEJ,GAAImF,EAAQ,CACRD,EAAgBA,EAActJ,KAAK,mBACnC,GAAIT,EAAKyB,YAAY0C,QAAS,CAC1BnE,EAAKyB,YAAY0C,QAAQO,eAClB1E,EAAKyB,YAAY0C,aAEzB,CACHU,EAAQ2B,EAAUxG,EAAKyB,YAAauE,GACpCkE,EAAcrF,EAAMC,SACpBD,EAAM8E,OAAO,SAAU3J,EAAKmB,qBAC5B+I,EAAYN,OAAO/E,GACnB,IAAKqF,EAAYjF,cACNiF,EAAYpF,SAASX,QAEhC,IAAK4F,EAAcI,WAAWlF,OAC1B8E,EAAgBA,EAAcjF,SAItC5F,EAAMmF,QAAQ0F,GACdA,EAAcH,SACd5J,EAAKiH,qBAGTvF,mBAAoB,WAChB,IAAI1B,EAAOC,KAEX,IAAKD,EAAKD,QAAQsC,YACd,OAGJ,IAAKrC,EAAKuE,aACNvE,EAAKuE,aAAevF,EAAEE,EAAMkL,OAAO,8JAA+JpK,EAAKD,QAAQyC,SAASG,QAAQgE,SAAS3G,EAAKF,UAItP2H,gBAAiB,SAAUP,EAAWrC,GAClC,GAAIA,EAAMK,MACN,OAGJ,IAAI4C,EAAWjD,EAAMiD,SACrB,IAAIT,EAAkBH,EAAUzG,KAAK,0BAA0BsB,GAAG,GAClE,GAAI+F,GAAY,UAAYA,GAAY,aAAeA,GAAY,WAC/DA,GAAY,cAAgBA,GAAY,iBAAmBA,GAAY,mBACvET,EAAgBgD,YAEhBhD,EAAgBiD,QAIxBrG,cAAe,SAAU1C,GACrB,IAAIvB,EAAOC,KACX,GAAIsB,EAAW4C,QACX5C,EAAW4C,QAAQoG,QAAQ,SAAUxG,GACjC,GAAIA,EAAOI,QACPnE,EAAKiE,cAAcF,OAChB,CACH,IAAI+D,EACJ,IAAI3B,EAAQnG,EAAKoG,QAAQrC,EAAOoC,OAChC,IAAIU,EAAOV,EAAMU,KACjB,GAAIV,EAAMlF,WAAakF,EAAMlF,UAAU4F,GAAM9C,EAAO+D,UAChDA,EAAW3B,EAAMlF,UAAU4F,GAAM9C,EAAO+D,eAExCA,EAAW9H,EAAKiB,UAAU4F,GAAM9C,EAAO+D,UAG3C,GAAIA,EACA/D,EAAO+D,SAAWA,EAAS0C,SAAWzG,EAAO+D,aAOjE3F,mBAAoB,WAChB,IAAIlB,EAAYjC,EAAEY,OAAO,KAAM,GAAIK,KAAKgB,WAExC,IAAK,IAAIkF,KAASlG,KAAKmG,QACnBnF,EAAYjC,EAAEY,OAAO,KAAM,GAAIqB,EAAWhB,KAAKmG,QAAQD,GAAOlF,WAElEhB,KAAK+D,oBAAsByG,EAAoBxJ,MAKvD,SAASwJ,EAAoBxJ,GACzB,IAAK,IAAIkF,KAASlF,EAAW,CACzB,IAAI6G,EAAW7G,EAAUkF,GACzB,GAAK2B,EAAS0C,gBAAkB1C,EAAS0C,UAAY,mBACzC1C,IAAa,UAAYA,IAAa,MAAQ2C,EAAoB3C,GAC1E,OAAO,KAGf,OAAO,MAGX,SAAStB,EAAU3B,EAAOE,GAEtB,GAAIF,EAAME,MAAQA,EACd,OAAOF,EAGX,GAAIA,EAAMV,QACN,IAAI,IAAIa,EAAI,EAAGA,EAAIH,EAAMV,QAAQc,OAAQD,IAAK,CAC1C,IAAI0F,EAAOlE,EAAU3B,EAAMV,QAAQa,GAAID,GACvC,GAAI2F,EACA,OAAOA,GAU3B,OAJItL,EAAGuL,OAAO9J,GACVzB,EAAGuL,OAAOhL,GAGPV,OAAOC,QArxBd,CAuxBoB,mBAAVpB,QAAwBA,OAAO8M,IAAM9M,OAAS,SAAS+M,EAAIC,EAAIC,IAAMA,GAAMD"}